<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="insco_spacing">
        <div class="row">
            <div class="col-4 mb4"/>
            <div class="col-8 mb4 text-left">
            </div>
        </div>
    </template>

    <template id="insco_account_external_layout_standard">
        <t t-set="get_addr" t-value="get_addr"/>
        <t t-if="not o" t-set="o" t-value="doc"/>
        <t t-if="not company">
            <!-- Multicompany -->
            <t t-if="company_id">
                <t t-set="company" t-value="company_id"/>
            </t>
            <t t-elif="o and 'company_id' in o">
                <t t-set="company" t-value="o.company_id.sudo()"/>
            </t>
            <t t-else="else">
                <t t-set="company" t-value="res_company"/>
            </t>
        </t>
        <div class="header">
            <div class="row">
                <div class="col-3 mb4" style="margin-top: 25px;">
                    <img class="img-fluid mx-auto d-block" style="max-width: 100%;" t-if="company.logo" t-att-src="image_data_uri(company.logo)" alt="Logo"/>
                </div>
                <div class="col col-4 text-left" style="font-size: 8px;">
                    <div class="row" style="color: #3929C8;">
                        <div class="col-12">
                            SENDER OF THE INVOICE
                        </div>
                    </div>
                    <div class="row" style="background-color: #808080;color: white;">
                        <div class="col-12">
                            R.F.C. NAME AND SOCIAL REASON
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12" style="font-size: 10px !important;">
                            <strong><span t-esc="company.vat"/></strong><br/>
                            <strong><span t-esc="company.name"/></strong>
                        </div>
                    </div>
                    <div class="row" style="background-color: #808080;color:white;">
                        <div class="col-12">
                            FISCAL ADDRESS
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <span t-esc="get_addr(company)"/>
                        </div>
                    </div>
                    <div class="row" style="background-color: #808080;color: white;">
                        <div class="col-12">
                            FISCAL POSITION
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12" style="font-size: 10px !important;">
                            <strong><span t-esc="company.partner_id.property_account_position_id.name"/></strong>
                        </div>
                    </div>
                </div>
                <div class="col-2 text-center">
                    <img alt="Barcode" style="width: 100%;height: 110px;" t-att-src="'/report/barcode/?type=QR&amp;value=%s' % quote_plus(
                            'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?' + keep_query(
                                re=o.l10n_mx_edi_cfdi_supplier_rfc, rr=o.l10n_mx_edi_cfdi_customer_rfc,
                                tt=o.l10n_mx_edi_cfdi_amount, id=o.l10n_mx_edi_cfdi_uuid)
                                + '&amp;fe=%s' % quote_plus(
                                    sello, 'utf-8', 'strict', '=/').replace('%2B', '+'))" />
                </div>
                <div class="col-3 text-right">
                    <div class="row"/>
                    <div class="row" style="background-color: #808080;color: white;">
                        <div class="col-12" style="font-size: 12px !important;text-align: right;">
                            <span>INVOICE</span>
                        </div>
                    </div>
                    <div class="row" style="color: red;">
                        <div class="col-12" style="font-size: 14px !important;text-align: right;">
                            Serie  <span t-esc="doc.number"/>
                        </div>
                    </div>
                    <div class="row" style="background-color: #808080;color: white;">
                        <div class="col-12" style="font-size: 12px !important;text-align: right;">
                            <span>DATE AND TIME OF EMITION</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12" style="font-size: 16px !important;text-align: center;padding-top: 10px;font-family: 'Courier New', Courier, monospace;">
                            <strong><span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y/%m/%d %H:%M:%S')"/></strong>
                        </div>
                    </div>
                </div>
                <!-- <div class="col-1"/> -->
            </div>
        </div>
        <div class="article o_report_layout_standard"  t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')">
            <t t-raw="0"/>
        </div>
        <div class="footer">
            <div class="text-right">
                <div class="digital-stamp-content float-left" style="font-family: 'Courier New', Courier, monospace;">
                    <strong>This document is a printed representation of a CFDI - Version 3.3</strong>
                </div>
                <div t-if="report_type == 'pdf'" class="text-muted float-right" style="font-family: 'Courier New', Courier, monospace;">
                    page <span class="page"/> to <span class="topage"/>
                </div>
            </div>
        </div>
    </template>

    <template id="inherit_report_invoice_document_with_payments">
        <t t-call="w_document_mod.insco_account_external_layout_standard">
            <t t-set="o" t-value="doc.with_context({'lang': lang})"/>
            <t t-set="get_taxes" t-value="get_taxes"/>
            <div class="page">
                <t t-if="not company">
                    <!-- Multicompany -->
                    <t t-if="company_id">
                        <t t-set="company" t-value="company_id"/>
                    </t>
                    <t t-elif="o and 'company_id' in o">
                        <t t-set="company" t-value="o.company_id.sudo()"/>
                    </t>
                    <t t-else="else">
                        <t t-set="company" t-value="res_company"/>
                    </t>
                </t>
                <div style="font-size: 8px !important;width: 100%;padding: 0px 30px;">
                    <div class="row">
                        <div class="col-2"/>
                        <div class="col-10">
                            <span style="background-color: #808080; font-size: 12px; color: white;">
                                <strong style="padding: 40px !important;">SENDER FROM:   </strong>
                            </span>
                            <span style="font-size: 12px;" t-esc="get_addr(company)"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-7">
                            <span style="font-size: 12px;color: #A17373;">FISCAL CHECK RECEIVER </span>
                        </div>
                        <div class="col-5" style="background-color: #808080; font-size: 12px; color: white;">
                            <span>AUTHORICE SUPPLIER OF CERTIFICATE </span>
                        </div>
                    </div>
                    <div class="row text-center">
                        <div class="col-2 text-center" style="background-color: #808080; font-size: 12px; color: white;">
                            <span >R.F.C. </span>
                        </div>
                        <div class="col-5 text-center" style="background-color: #808080; font-size: 12px; color: white;">
                            <span>SOCIAL REASON </span>
                        </div>
                        <div class="col-5 text-center" style="font-size: 12px;">
                            <span t-if="get_pac_name(o) and get_pac_rfc(o)">
                                <t t-esc="get_pac_name(o)" /> - <t t-esc="get_pac_rfc(o)" />
                            </span>
                        </div>
                    </div>
                    <div class="row text-center">
                        <div class="col-2">
                            <b><span style="font-size: 12px;font-family: 'Courier New', Courier, monospace;" t-esc="o.partner_id.vat" /></b>
                        </div>
                        <div class="col-5" >
                            <b><span style="font-size: 10px;font-family: 'Courier New', Courier, monospace;" t-esc="o.partner_id.name" /></b>
                        </div>
                        <div class="col-5 text-center" style="background-color: #808080; font-size: 12px; color: white;">
                            <span style="font-size: 12px;">SENDER DIGITAL SELLER CERTIFIC</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-7"/>
                        <div class="col-5 text-center" style="font-size: 12px;">
                            <span t-esc="o.l10n_mx_edi_cfdi_certificate_id.serial_number" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-7" style="background-color: #808080; font-size: 12px; color: white;">
                            <span>FISCAL FOLIO </span>
                        </div>
                        <div class="col-5" style="background-color: #808080; font-size: 12px; color: white;">
                            <span>CFDI USAGE</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-7" style="font-size: 14px;color: red;padding-top: 10px;font-family: 'Courier New', Courier, monospace;">
                            <b><span t-esc="o.l10n_mx_edi_cfdi_uuid"/></b>
                        </div>
                        <div class="col-5" style="font-size: 16px !important;text-align: center;padding-top: 10px;font-family: 'Courier New', Courier, monospace;">
                            <span t-if="o.l10n_mx_edi_usage" t-esc="o.l10n_mx_edi_usage"/><span t-if="o.l10n_mx_edi_usage" t-esc="'-'"/><span t-if="o.l10n_mx_edi_usage" t-field="o.l10n_mx_edi_usage"/>
                        </div>
                    </div>
                </div>
                <br/>
                <t t-set="colspan" t-value="8"/>
                <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>
                <t t-set="amount_without_discount" t-value="0"/>
                <table class="table table-sm o_main_table" name="invoice_line_table" style="font-size: 12px;min-height: 400px !important;">
                    <thead>
                        <tr style="background-color: #808080; color: white;">
                            <th class="text-center">CODE</th>
                            <th class="text-center">PRODUCT KEY</th>
                            <th class="text-center">DESCRIPTION</th>
                            <th class="text-center">UOM</th>
                            <th class="text-center">QUANTITY</th>
                            <th class="text-center">PRICE</th>
                            <th t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                <span>DISCOUNT</span>
                                <t t-set="colspan" t-value="colspan+1"/>
                            </th>
                            <th class="text-center">TAX AMOUNT</th>
                            <th class="text-center">AMOUNT</th>
                        </tr>
                    </thead>
                    <tbody class="invoice_tbody">
                        <t t-foreach="o.invoice_line_ids" t-as="line">
                            <t t-set="amount_without_discount" t-value="amount_without_discount + (line.price_unit * line.quantity)"/>
                            <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                    <td style="border-left: 1px solid #808080;border-bottom:1px solid #cccccc;" name="product_code"><span t-field="line.product_id.default_code"/></td>
                                    <td style="border-left: 1px solid #808080;border-bottom:1px solid #cccccc;" name="product_key"><span t-esc="'%s - %s' % (line.product_id.l10n_mx_edi_code_sat_id.code or '', line.product_id.l10n_mx_edi_code_sat_id.name or '')"/></td>
                                    <td style="border-left: 1px solid #808080;border-bottom:1px solid #cccccc;" name="account_invoice_line_name"><span t-field="line.name"/></td>
                                    <td style="border-left: 1px solid #808080;border-bottom:1px solid #cccccc;" class="text-center">
                                        <span t-esc="'%s - %s' % (line.uom_id.l10n_mx_edi_code_sat_id.code, line.uom_id.l10n_mx_edi_code_sat_id.name)" groups="uom.group_uom"/>
                                    </td>
                                    <td style="border-left: 1px solid #808080;border-bottom:1px solid #cccccc;" class="text-center">
                                        <span t-field="line.quantity"/>
                                    </td>
                                    <td style="border-left: 1px solid #808080;border-bottom:1px solid #cccccc;" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span t-field="line.price_unit" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                    <td style="border-left: 1px solid #808080;border-bottom:1px solid #cccccc;" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span t-field="line.discount"/>
                                    </td>
                                    <td style="border-left: 1px solid #808080;border-bottom:1px solid #cccccc;" t-attf-class="text-left {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <t t-foreach="get_taxes(line)" t-as="tax">
                                            <div class="row">
                                                <div class="col-7 text-left">
                                                    <span t-esc="tax[0]"/>
                                                </div>
                                                <div class="text-left">
                                                    <span t-esc="tax[1]" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                                </div>
                                            </div>
                                        </t>
                                    </td>
                                    <td style="border-left: 1px solid #808080;border-right: 1px solid #808080;border-bottom:1px solid #cccccc;" class="text-right o_price_total">
                                        <span t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                    </td>
                                </t>
                                <t t-if="line.display_type == 'line_section'">
                                    <td t-att-colspan="colspan">
                                        <span t-field="line.name"/>
                                    </td>
                                    <t t-set="current_section" t-value="line"/>
                                </t>
                                <t t-if="line.display_type == 'line_note'">
                                    <td t-att-colspan="colspan">
                                        <span t-field="line.name"/>
                                    </td>
                                </t>
                            </tr>

                            <t t-if="line_last">
                                <tr class="is-subtotal" style="font-size: 14px;font-family: 'Courier New', Courier, monospace;">
                                    <td class="text-right" colspan="2">
                                        <strong class="mr16">CFDI Related:</strong>
                                    </td>
                                    <td class="text-left">
                                        <t t-set="related" t-value="o.get_cfdi_related()" />
                                        <t t-if="len(related) > 0">
                                            <t t-foreach="related['related']" t-as="number">
                                                <t t-esc="'%s ' % number" />
                                            </t>
                                        </t>
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>
                <div class="clearfix">
                    <div id="total1" class="row" style="background-color: #808080;color: white;margin-left: 1px;margin-right: 1px;margin-bottom: 10px;">
                        <div class="col col-12" style="font-size: 12px;">
                            <span>PAYMENT DETAILS</span>
                        </div>
                    </div>
                    <div id="total" class="row" style="font-size: 12px;">
                        <div class="col col-9">
                            <div class="row" style="font-size: 12px;font-family: 'Courier New', Courier, monospace;">
                                <div class="col-4" style="padding-bottom: 5px;">
                                    <b><span>Payment Form</span></b>
                                </div>
                                <div class="col-4" style="padding-bottom: 5px;">
                                    <b><span>Payment Method</span></b>
                                </div>
                                <div class="col-4" style="padding-bottom: 5px;">
                                    <b><span>Account Number</span></b>
                                </div>
                            </div>
                            <div class="row" style="font-size: 12px;font-family: 'Courier New', Courier, monospace;">
                                <div class="col-4" style="padding-bottom: 10px;">
                                    <b><span t-esc="o.l10n_mx_edi_payment_method_id.code"/> <span t-esc="o.l10n_mx_edi_payment_method_id.name" /></b>
                                </div>
                                <div class="col-4" style="padding-bottom: 10px;">
                                    <b><span t-if="o.payment_method" t-esc="o.payment_method" /></b>
                                </div>
                                <div class="col-4" style="padding-bottom: 10px;">
                                    <b><span t-if="o.l10n_mx_edi_partner_bank_id.acc_number" t-esc="o.l10n_mx_edi_partner_bank_id.acc_number" /></b>
                                </div>
                            </div>
                            <div class="row" />
                            <div class="row" />
                            <div class="row" style="font-size: 12px;font-family: 'Courier New', Courier, monospace;">
                                <div class="col-12" style="padding-bottom: 10px;">
                                    <strong>RFC Certificate Supplier   <t t-if="get_pac_rfc(o)" t-esc="get_pac_rfc(o)" /></strong>
                                </div>
                            </div>
                            <div class="row" style="font-size: 12px;font-family: 'Courier New', Courier, monospace;">
                                <div class="col-12">
                                    <b><span>TOTAL WITH CHAR:</span></b>
                                </div>
                            </div>
                            <div class="row" style="font-size: 12px;font-family: 'Courier New', Courier, monospace;">
                                <div class="col-12">
                                    <b><span t-esc="o.l10n_mx_edi_amount_to_text()"/></b>
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <table class="table table-sm">
                                <tr>
                                    <td class="text-right" style="background-color: #EEECE0;">
                                        <strong>Subtotal</strong>
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="amount_without_discount"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-right" style="background-color: #EEECE0;">
                                        <strong>Discount</strong>
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="amount_without_discount - o.amount_untaxed"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-right" style="background-color: #EEECE0;">
                                        <strong>New Subtotal</strong>
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="o.amount_untaxed"
                                            t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                                <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                    <tr>
                                        <t t-if="len(o.tax_line_ids) == 1 and o.amount_untaxed == amount_by_group[2]">
                                            <td class="text-right" style="background-color: #EEECE0;">
                                                <strong><span t-esc="amount_by_group[0]"/></strong>
                                            </td>
                                            <td class="text-right o_price_total">
                                                <span t-esc="amount_by_group[3]" />
                                            </td>
                                        </t>
                                        <t t-else="">
                                            <td class="text-right" style="background-color: #EEECE0;">
                                                <span t-esc="amount_by_group[0]"/>
                                            </td>
                                            <td class="text-right o_price_total">
                                                <span t-esc="amount_by_group[3]"/>
                                            </td>
                                        </t>
                                    </tr>
                                </t>
                                <tr>
                                    <td class="text-right" style="background-color: #EEECE0;">
                                        <strong>TOTAL</strong>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="o.amount_total"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div t-if="o.observations" class="row" style="background-color: #808080;color: white;margin-left: 1px;margin-right: 1px;margin-bottom: 10px;">
                        <div class="col col-12" style="font-size: 12px;">
                            <span>OBSERVATIONS</span>
                        </div>
                    </div>
                    <div t-if="o.observations" class="row">
                        <div class="col col-12">
                            <strong><span style="font-size: 12px;font-family: 'Courier New', Courier, monospace;" t-if="o.observations" t-esc="o.observations"/></strong>
                        </div>
                    </div>
                </div>
                <br/>
                <div style="page-break-inside: avoid; font-size: 12px; margin-left: 10px;margin-right: 10px;">
                    <div class="row" style="background-color: #808080;color: white;">
                        <div class="col-12 mb4 text-left">
                            <span>ORIGINAL CHAIN OF DIGITAL CERTIFICATION COMPLEMENT TO THE SAT</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mb4">
                            <span style="color: black;text-align: justify;font-size: 10px;font-family: 'Courier New', Courier, monospace;" t-if="o.cfdi_cadena" t-esc="o.cfdi_cadena"/>
                        </div>
                    </div>
                    <br/>
                    <div class="row" style="background-color: #808080;color: white;">
                        <div class="col-12 mb4 text-left">
                            <span>DIGITAL SELLET OF CFDI</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mb4 text-left">
                            <span style="color: black;text-align: justify;font-size: 10px;font-family: 'Courier New', Courier, monospace;" t-if="o.sello_cfdi" t-esc="o.sello_cfdi"/>
                        </div>
                    </div>
                    <br/>
                    <div class="row" style="background-color: #808080;color: white;">
                        <div class="col-12 mb4 text-left">
                            <span>DIGITAL SELLET OF SAT</span>
                        </div>
                    </div>
                    <div class="row" >
                        <div class="col-12 mb4 text-left">
                            <span style="color: black;text-align: justify;font-size: 10px;font-family: 'Courier New', Courier, monospace;" t-if="o.sello_sat" t-esc="o.sello_sat"/>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="account.report_invoice_with_payments">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-set="lang" t-value="doc.user_id.lang if doc.type in ('in_invoice', 'in_refund') else doc.partner_id.lang"/>
                <t t-call="w_document_mod.inherit_report_invoice_document_with_payments" t-lang="lang"/>
            </t>
        </t>
    </template>
</odoo>
